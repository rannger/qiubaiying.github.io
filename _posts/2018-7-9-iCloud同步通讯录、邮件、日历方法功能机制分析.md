---
layout:     post
title:      iCloud同步通讯录、邮件、日历方法功能机制分析
date:       2018-07-09
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - iCloud
    - 通讯录
    - 同步
--- 

- **1.云端与终端：**
    在一个同步时间间隔内，只有一端（终端或云端）的数据有更新，则以更新后的数据为准，所有在线终端和云端均更新为最新数据；

  在一个同步时间间隔内，在云端和终端分别对同一个联系人进行不同的修改操作，则最终以云端版本为准，覆盖终端数据（见测试case1.1， 1.2， 1.3， 1.4）；

  在一个同步时间间隔内，在云端和终端分别对同一个联系人做出修改和删除的操作，则删除联系人，云端和终端均删除该联系人数据（见测试case1.5）。
- **2.多终端：**
    在一个同步时间间隔内，若两个在线终端分别对同一联系人进行不同的修改操作，则以先完成的操作为准同步所有在线终端和云端的数据，该规则与终端类型无关。

  在一个同步时间间隔内，若两个在线终端分别对同一联系人进行删除和修改操作，则不管先完成的操作是修改还是删除，最终该联系人都将被删除，包括所有在线终端和云端，该规则与终端类型无关。

## 离线操作同步机制

若多个终端在离线状态下进行数据增、删、改操作造成通讯录数据不一致，终端在线后将会进行同步操作，icloud的同步机制可概括为：
- **1.** 若同一联系人的同一不可扩展字段（如联系人姓名）不一致，同步时以云端版本为准，详见测试case2.3；
- **2.**若同一联系人的同一可扩展字段（如手机号）不一致，同步时直接将所有不同的字段值合并，详见测试case2.2， 2.4， 2.6；
- **3.**若新增、删除操作造成同一联系人不是在所有终端和云端中都存在，同步时直接进行合并操作，同步后所有终端和云端中都是最齐全的通讯录版本，包括新增联系人以及还没有在所有终端、云端中都已经删除的联系人，详见测试case2.1， 2.5。

## 关闭通讯录同步功能

关闭iCloud通讯录同步功能时，用户还可以选择将自己的通讯录保留在IOS设备上或者从IOS设备上删除，根据用户需求保证数据不外泄。

注：1.联系人ID仅在当前设备唯一